<!-- docs/math/8-core-api.html -->
<section class="chapter" id="8-core-api">
    <h2 id="8-core-api">8. Core API の設計</h2>
    <div class="para">
        数独解読における数理的推論エンジンとユーザインターフェースを接続するためには、両者の関心領域を厳密に分離しつつも、双方向的な情報伝達を可能にする抽象層として Core API を設計することが必須となる。この API の本質的役割は、解読アルゴリズムが生成する内部的推論構造を、GUI が視覚的証跡として忠実に再構成できる形式へと翻訳する点にある。したがって、盤面状態、候補集合、推論ステップ、探索分岐といった数学的対象を、厳格に定義された抽象データ型として外部に提示することが求められる。内部表現としては、各セルの候補集合を $9$ ビットのマスクに写像し、さらに行・列・ボックス単位での使用済み数値を占有ビット列で管理する方式が最適である。しかしこれらは実装上の詳細にすぎず、外部 API では単一の `Board` 型として抽象化される。この抽象型は「セルが確定しているか」「候補がいくつ残っているか」といった問い合わせを一定の時間計算量で保証し、アルゴリズムの透明性を保ちながらも GUI 側からの不変条件の破壊を許さないよう設計されるべきである。推論規則の適用結果は `Step` 構造体として返却され、その内部には適用された規則の識別名、根拠となったセル群（証人集合）、削除された候補集合、確定された値、そして GUI 表示のための自然言語的説明文が格納される。これにより解読コアは純粋に制約理論的な縮約や探索の実行に専念しつつ、GUI 側はユーザに対して「どのセルが唯一候補であったため確定されたのか」「どの候補が矛盾により排除されたのか」といった論理的痕跡を逐次的に可視化できる。すなわち API は論理推論と可視的表現との間に明確な境界を引きながら、その両者を緊密に接続する役割を果たす。探索に関しては、関数 `solve(Board)` を再帰的に呼び出す標準的インターフェースが想定される。固定点計算によって候補削減が尽くされた後、なお未確定セルが残存する場合にのみ分岐が導入され、その過程で生成されるステップには特別に `branch` 識別子が付与される。この情報は GUI 側で明示的に提示され、論理的推論の必然性に基づく確定と、探索的仮置きによる枝分かれとを明確に区別する機能を持つ。こうして API 経由で全ての推論過程が逐一記録されることにより、難易度計算に資する定量的指標の収集や、教育的利用を目的とした学習データベースの構築が統一的な枠組みの下で可能となる。要するに、Core API は数理的制約充足系と人間中心的可視化系の境界に位置する形式的プロトコルであり、その設計如何が解読アルゴリズムの信頼性、GUI の透明性、そしてアプリケーション全体の教育的価値を決定する。抽象型と証跡構造体を中核に据えたこの設計は、数独解読を単なる計算作業から認知的・教育的営為へと昇華させるための不可欠な方法論的基盤である。
    </div>
</section>