<!-- docs/math/05-difficulty-metrics.html -->
<section class="chapter" id="05-difficulty-metrics">
    <h2 id="5-difficulty-metrics">5. <ruby>難易度<rt>なんいど</rt></ruby>の<ruby>計量学<rt>けいりょうがく</rt></ruby></h2>
    <div class="para">
        数独における「難易度」という概念は、素朴に考えれば与え値の数や初期配置の疎密度といった表層的な指標によって測られそうに見える。しかし実際にはそれは不十分であり、問題を解く際にどのような種類の推論規則を適用しなければならないか、その規則の複雑さや人間にとっての認知的負荷がどの程度か、さらに論理規則の適用だけでは解が得られず探索（仮置きとバックトラック）が必要になるかどうかといった要因が総合的に作用している。したがって難易度は、与え値の少なさではなく、解読過程そのものの複雑性を測る複合的な概念として定義されるべきである。この複雑性を形式化するために、まず各推論規則に固有の「原価」を定義する。たとえば naked single のように候補集合が自明に一つに収束する規則は人間にとって直観的に理解可能であるため低コストが割り当てられる。一方で X-Wing や Swordfish といった行列的パターンの検出は視覚的・認知的負荷が大きく、より高いコストを与えることが妥当である。盤面解読の trace を通じて適用された規則の列を $\{r_t\}$ とするとき、論理的コストは

        $$\mathrm{Cost}_{\text{logic}} = \sum_t w(r_t)$$

        と定義される。ただし $w(r_t)$ は規則 $r_t$ に割り当てられた定数である。この値は理論的に定めることもできるが、実際には既存の問題集に対する経験的調整によって較正される。しかし、論理規則だけで問題が解けるとは限らない。推論の閉包に達しても未確定セルが残る場合には探索が導入される。このときの探索は、仮置きと矛盾検出に基づく分岐とバックトラックからなるため、計算機的には指数的複雑性を伴い、人間にとっても「試しに置いてみて矛盾を確認する」という非直感的な操作を強いる。従って探索のコストは論理規則よりも桁違いに大きく評価する必要がある。分岐の数を $N_{\text{branch}}$、各分岐の深さを $\mathrm{depth}$ とすれば、探索コストは

        $$\mathrm{Cost}_{\text{search}} = \lambda N_{\text{branch}} + \mu \sum_{i=1}^{N_{\text{branch}}} d_i$$

        の形で定義できる。ここで $d_i$ は $i$ 番目の分岐の深さである。さらに情報理論的視点から候補集合の不確実性を定量化することができる。セル $v$ の候補集合 $D(v)$ に対して、候補 $d \in D(v)$ の出現確率を $p_d$ とすれば、エントロピーは

        $$H(v) = -\sum_{d \in D(v)} p_d \log p_d$$

        と定義される。この値は候補の散らばり具合を測る尺度であり、推論によって候補数が減少するごとに $H(v)$ も減少する。したがって各ステップにおける情報削減量 $\Delta H_t$ を評価し、それを総和することによって盤面全体の「情報収束度」を定量化できる。効率よく候補が削減されるほど $\Delta H_t$ は大きく、解読は容易であると解釈できる。以上を総合すると、数独の難易度は単なる主観的感覚ではなく、論理的コスト、探索コスト、情報削減の三要素から構成される形式的指標として定義できる。その具体形は

        $$D = \alpha\ C_{\text{logic}} + \beta\ C_{\text{search}} - \gamma \sum_{t=1}^{T} \Delta H_t$$

        で与えられる。ここで $C_{\text{logic}}$ は推論規則の適用に伴う論理的コスト、 $C_{\text{search}}$ は仮置きやバックトラックに基づく探索コスト、 $\Delta H_t$ は第 $t$ ステップにおける情報量削減、 $T$ は推論過程の全ステップ数を表す。また $\alpha,\beta,\gamma$ は実験的に決定される重みであり、既存の問題集に対して回帰的に最適化される。こうして得られた $D$ は、問題を難易度クラス（Easy, Medium, Hard, Expert など）に分類する客観的な基準として機能し、ユーザが問題を選択する際の有効な指標となる。
    </div>
</section>