<!-- docs/math/02-inference-rules.html -->
<section class="chapter" id="02-inference-rules">
    <h2 id="2-inference-rules">2. <ruby>推論規則<rt>すいろんきそく</rt></ruby>の設計</h2>
    <div class="para">
        数独を <ruby>制約充足問題<rt>せいやくじゅうそくもんだい</rt></ruby> (CSP) として定式化した場合、解読過程の核心は候補集合の段階的削減にある。候補集合全体は

        $$\Sigma = \prod_{r,c} \mathcal{P}(\{1,\dots,9\})$$

        と表され、 $\sigma \in \Sigma$ は「全セルにおける候補集合の配置」を意味する。この $\Sigma$ は包含関係に基づく順序構造を持ち、<ruby>完備束<rt>かんびそく</rt></ruby> (complete lattice) をなす。最大元は「全てのセルが $\{1,\dots,9\}$ を候補として保持する状態」、最小元は「全てのセルが確定値を持つ解状態」である。候補削減の過程を束上の写像として形式化することで、推論規則の性質を一般的な代数的枠組みの中に位置づけることができる。推論規則とは $\gamma : \Sigma \to \Sigma$ で表される写像であり、制約に基づいて候補集合を縮小する作用を持つ。この種の作用素は形式概念分析やデータベース理論における <ruby>closure operator<rt>クロージャ作用素</rt></ruby> と同型であり、つねに以下の二性質を満たす。第一に<ruby>単調性<rt>たんちょうせい</rt></ruby> (monotonicity)： $A \subseteq B \implies \gamma(A) \subseteq \gamma(B)$。これは情報が増えれば推論による候補削減もそれに従うことを意味する。第二に<ruby>冪等性<rt>べきとうせい</rt></ruby> (idempotency)： $\gamma(\gamma(\sigma)) = \gamma(\sigma)$。すなわち同一の規則を繰り返し適用しても新しい情報は生じず、有限回の適用で安定化する。これら二つの性質に加え、通常の推論規則は <ruby>縮小性<rt>しゅくしょうせい</rt></ruby> (contractiveness) をも満たす。すなわち $\gamma(\sigma) \subseteq \sigma$ が常に成立し、候補が増えることはない。複数の規則 $\gamma_1,\dots,\gamma_k$ を合成した写像 $\Gamma = \gamma_1 \circ \gamma_2 \circ \cdots \gamma_k$ もまた<ruby>縮約作用素<rt>しゅくやくさようそ</rt></ruby>である。このとき<ruby>反復過程<rt>はんぷくかてい</rt></ruby>

        $$\sigma_{t+1} = \Gamma(\sigma_t), \qquad \sigma_0 = \sigma_{\text{init}}$$

        は必ず<ruby>最小不動点<rt>さいしょうふどうてん</rt></ruby>

        $$\mathrm{lfp}(\Gamma) = \lim_{t \to \infty} \sigma_t$$

        に到達する。これは Knaster–Tarski の <ruby>不動点定理<rt>ふどうてんていり</rt></ruby> の <ruby>直接的帰結<rt>ちょくせつてききけつ</rt></ruby>であり、到達点 $\mathrm{lfp}(\Gamma)$ は「論理的に尽きるまで候補削減を施した<ruby>極限状態<rt>きょくげんじょうたい</rt></ruby>」に対応する。このことは、推論過程を単なる<ruby>逐次的操作<rt>ちくじてきそうさ</rt></ruby>ではなく、<ruby>不動点計算<rt>ふどうてんけいさん</rt></ruby>として体系的に理解できることを示す。推論規則の適用が有効であるためには、<ruby>健全性<rt>けんぜんせい</rt></ruby> (soundness) が保証されなければならない。形式的には、任意の<ruby>解写像<rt>かいしゃぞう</rt></ruby> $\sigma^* : V \to \{1,\dots,9\}$ に対して

        $$\sigma^*(r,c) \in \gamma(\sigma)(r,c) \qquad \forall (r,c)\in V.$$

        すなわち推論によって削除された候補は、元の CSP におけるいかなる解にも含まれない。健全性は局所的な削除操作が解空間を誤って排除しないことを保証する点で不可欠である。一方で、推論規則群が<ruby>完全性<rt>かんぜんせい</rt></ruby> (completeness) を持つとは限らない。すなわち規則適用をいくら繰り返しても候補が一意に収束せず、<ruby>探索<rt>たんさく</rt></ruby>が<ruby>不可避<rt>ふかひ</rt></ruby>となる場合が存在する。したがって推論規則は論理的帰結の「<ruby>計算可能な近似<rt>けいさんかのうなきんじ</rt>
        </ruby>」に過ぎないが、それでも SAT ソルバにおける unit propagation と同様に、解探索を劇的に効率化する役割を果たす。具体的規則としては、セルの候補が唯一に絞られた場合に確定する naked single、行・列・ブロック内である数字がただ一つのセルにしか現れない場合に確定する hidden single、ブロックと行・列の包含関係に基づく pointing pair や claiming、候補配置の対称性に依拠する X-Wing や Swordfish、さらに候補を命題変数に写像し含意グラフを構成することで矛盾や強制を検出するチェイン規則などが挙げられる。これらはいずれも<ruby>単調性<rt>たんちょうせい</rt></ruby>・<ruby>冪等性<rt>べきとうせい</rt></ruby>を満たし、健全性を保証するため、適用過程全体は「<ruby>形式的証明列<rt>けいしきてきしょうめいれつ</rt></ruby>」として理解できる。極限状態 $\mathrm{lfp}(\Gamma)$ は推論規則のみで到達できる論理的限界を与える。しかし多くの数独問題では、この不動点に到達してもなお未確定のセルが残る。このとき探索（<ruby>分岐帰納法<rt>ぶんききのうほう</rt></ruby>、バックトラック、あるいは<ruby>分岐限定法<rt>ぶんきげんていほう</rt></ruby>）が不可欠となる。すなわち推論規則は探索の<ruby>補助手段<rt>ほじょしゅだん</rt></ruby>として位置づけられ、候補集合を削減し探索空間を大幅に<ruby>剪定<rt>せんてい</rt></ruby>する役割を担う。形式的には、推論は完全な解空間探索に先立つ <ruby>局所的制約伝播<rt>きょくしょてきせいやくでんぱ</rt></ruby> として理解され、計算論的論理における constraint propagation の<ruby>典型的事例<rt>てんけいてきじれい</rt></ruby>と見なせる。結局のところ、数独における候補削減の形式化は、単なるパズル解法技術にとどまらず、縮約作用素の不動点理論、健全性と完全性の区別、制約伝播と探索の相補関係といった<ruby>計算論的基礎概念<rt>けいさんろんてききそがいねん</rt></ruby>を具体的に検証する場を提供する。ここに数独の推論規則の<ruby>学術的価値<rt>がくじゅつてきかち</rt></ruby>がある。
    </div>
</section>